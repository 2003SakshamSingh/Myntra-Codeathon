<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Myntra - Community Forum</title>
    <link rel="icon" href="../IMAGES/Logo/myntra.svg" />
    <script
      src="https://kit.fontawesome.com/a076d05399.js"
      crossorigin="anonymous"
    ></script>

    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
    />
    <link rel="stylesheet" href="../Style/navbar.css" />
    <link rel="stylesheet" href="../Style/footer.css" />
    <link rel="stylesheet" href="../Style/Home&Living.css" />
    <link rel="stylesheet" href="../Style/communityForum.css" />
  </head>
  <body>
    <!-- Nav-Bar -->
    <header id="headportion"></header>
    <div class="nav-padding"></div>

    <div class="title">
      <h2>Welcome to Myntra's very own Community Forum !</h2>
      <br />
      <p>
        Chat with different communities and groups <br />
        Take suggestions, ask for reviews and much more ...
      </p>
    </div>

    <br />
    <div class="fpss">
      <div class="happy-customer">
        <img src="../IMAGES/Sample-Images/Happy Customer.jpg" alt="" />
      </div>
      <!-- slider start -->
      <div class="slider">
        <div class="slides">
          <!-- radio buttons start-->
          <input type="radio" name="radio-btn1" id="radio1" />
          <input type="radio" name="radio-btn1" id="radio2" />
          <input type="radio" name="radio-btn1" id="radio3" />
          <input type="radio" name="radio-btn1" id="radio4" />
          <input type="radio" name="radio-btn1" id="radio5" />
          <!--radio buttons end -->
          <!--slide images start-->
          <div class="slide first">
            <img src="../IMAGES/Sample-Images/Review1.jpg" alt="" />
            <div class="desc">
              " It is awesome I was very happy after wearing this top in this price the cloth quality is good especially it's neck design is awesome. "
            </div>
          </div>
          <div class="slide">
            <img src="../IMAGES/Sample-Images/Review2.png" alt="" />
            <div class="desc">
              " Both the shirt and cap are essential additions to my wardrobe. The shirt is comfortable and versatile, retaining its quality after numerous washes. The cap offers excellent sun protection with a stylish design and comfortable fit. These items are both reliable and stylish, enhancing my overall clothing choices. "
            </div>
          </div>
          <div class="slide">
            <img src="../IMAGES/Sample-Images/Review3.png" alt="" />
            <div class="desc">
              " I'm thoroughly impressed with my trolley bag. It's not only spacious but also incredibly durable, withstanding rough handling during travels. The multiple compartments make organization a breeze, and the wheels glide smoothly. Its stylish design is an added bonus. This bag has truly made my trips hassle-free and fashionable. "
            </div>
          </div>
          <div class="slide">
            <img src="../IMAGES/Sample-Images/Review4.jpeg" alt="" />
            <div class="desc">
              " The earrings I purchased are exquisite. They add a touch of elegance to any outfit and are comfortable to wear all day. The quality is apparent in their shine and sturdiness. The nightsuit is incredibly comfortable. The fabric is soft against the skin, and stylish, too, making bedtime feel like a luxurious experience. Both items have exceeded my expectations. "
            </div>
          </div>
          <div class="slide">
            <img src="../IMAGES/Sample-Images/Review5.jpeg" alt="" />
            <div class="desc">
              " It is a stylish and versatile accessory. It boasts ample space for essentials, sturdy construction, and a design that complements various outfits. Its functionality and aesthetic make it an excellent addition to my wardrobe. "
            </div>
          </div>
          <!--slide images end-->
          <!--automatic navigation start-->
          <div class="navigation-auto">
            <div class="auto-btn1"></div>
            <div class="auto-btn2"></div>
            <div class="auto-btn3"></div>
            <div class="auto-btn4"></div>
            <div class="auto-btn5"></div>
          </div>
          <!--automatic navigation end-->
        </div>
        <!--manual navigation start-->
        <div class="navigation-manual">
          <label for="radio1" class="manual-btn"></label>
          <label for="radio2" class="manual-btn"></label>
          <label for="radio3" class="manual-btn"></label>
          <label for="radio4" class="manual-btn"></label>
          <label for="radio5" class="manual-btn"></label>
        </div>
        <!--manual navigation end-->
      </div>
      <!-- slider end -->
    </div>

    <!-- section buttons -->
    <div class="container">
      <div class="left">
        <div class="switchSeller">
          <div
            class="comm addSeller open-button"
            onclick="openForm1()"
            id="addSeller"
          >
            <i class="fas fa-plus fa-2xl"></i>
          </div>
          <div class="form-popup1" id="myForm1">
            <form id="sellerForm" class="form-container1">
              <h1>Register your Store</h1>
              <hr />
              <label for="seller"><b>Seller Name</b></label>
              <input
                id="sellerNameInput"
                type="text"
                placeholder="Enter seller Name"
                name="seller"
                required
              />
              <label for="seller"><b>Seller Address</b></label>
              <input
                id="sellerAddressInput"
                type="text"
                placeholder="Enter seller address"
                name="seller"
                required
              />
              <label for="seller"><b>Seller Description</b></label>
              <input
                id="sellerDescriptionInput"
                type="text"
                placeholder="Enter seller description"
                name="seller"
                required
              />

              <button type="submit" class="btn">Create</button>
              <button type="button" class="btn cancel" onclick="closeForm1()">
                Close
              </button>
            </form>
          </div>
          <!-- <div class="comm" id="comm1">
            <h2>Marwadi</h2>
          </div>
          <div class="comm" id="comm2">
            <h2>Shadi</h2>
          </div>
          <div class="comm" id="comm3">
            <h2>Bihar</h2>
          </div>
          <div class="comm" id="comm4">
            <h2>Influencer</h2>
          </div>
          <div class="comm" id="comm5">
            <h2>Family</h2>
          </div> -->
        </div>

        <div class="seller-chat" style="overflow: hidden">
          <h2>Myni-Bazaar</h2>
          <br />
          <h4 class="seller-name" id="seller-name"></h4><h5 class="seller-details" id="seller-details"></h5>

          <div class="sellerPostsContainer">Click on a Seller to view its posts.</div>
          <form class="addSellerPostForm">
            <input type="file" id="file-input-1" name="file-input-1" />
            <label id="file-input-label-1" for="file-input-1"> + </label>
            <input
              type="text"
              class="input-message"
              id="sellerPostContent"
              placeholder="Type your message..."
            />
            <button class="send-btn addPostBtn">
              <img src="../IMAGES/Chat-Forum/send_icon.svg" alt="" />
            </button>
          </form>
        </div>
        <div class="switch">
          <div
            class="comm addCommunity open-button"
            onclick="openForm2()"
            id="addCommunity"
          >
            <i class="fas fa-plus fa-2xl"></i>
          </div>
          <div class="form-popup2" id="myForm2">
            <form id="communityForm" class="form-container2">
              <h1>Create your Community</h1>
              <hr />
              <label for="community"><b>Community Name</b></label>
              <input
                id="communityNameInput"
                type="text"
                placeholder="Enter Community Name"
                name="community"
                required
              />

              <button type="submit" class="btn">Create</button>
              <button type="button" class="btn cancel" onclick="closeForm2()">
                Close
              </button>
            </form>
          </div>
          <!-- <div class="comm" id="comm1">
            <h2>Marwadi</h2>
          </div>
          <div class="comm" id="comm2">
            <h2>Shadi</h2>
          </div>
          <div class="comm" id="comm3">
            <h2>Bihar</h2>
          </div>
          <div class="comm" id="comm4">
            <h2>Influencer</h2>
          </div>
          <div class="comm" id="comm5">
            <h2>Family</h2>
          </div> -->
        </div>

        <div class="community-chat" style="overflow: hidden">
          <h2>Influ-Hub</h2>
          <br />
          <h4 class="community-name" id="community-name"></h4>
          <div class="communityPostsContainer">Click on a Community to view its posts.</div>
          <form class="addCommunityPostForm">
            <input type="file" id="file-input-1" name="file-input-1" />
            <label id="file-input-label-1" for="file-input-1"> + </label>
            <input
              type="text"
              class="input-message"
              id="communityPostContent"
              placeholder="Type your message..."
            />
            <button class="send-btn addPostBtn">
              <img src="../IMAGES/Chat-Forum/send_icon.svg" alt="" />
            </button>
          </form>
        </div>
      </div>

      <div class="right" style="overflow: hidden">
        <div class="global-chat">
          <h2>Global Chat</h2>
          <br />

          <div class="popularPostsContainer"></div>

          <form class="bottomDiv">
            <input type="file" id="file-input-2" name="file-input-2" />
            <label id="file-input-label-2" for="file-input-2"> + </label>
            <input
              type="text"
              class="input-message"
              id="globalPostContent"
              placeholder="Type your message..."
            />
            <button class="send-btn addPostBtn">
              <img src="../IMAGES/Chat-Forum/send_icon.svg" alt="" />
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer id="footerEl"></footer>

    <script src="../JS/Home&living.js" type="module"></script>

    <script type="text/javascript">
      function googleTranslateElementInit() {
        new google.translate.TranslateElement(
          {
            pageLanguage: "en,",
            includedLanguages: "hi,en,bn,gu,kn,ml,mr,ta,te,ur,",
          },
          "google_translate_element"
        );
      }
    </script>

    <script
      src="https://kit.fontawesome.com/e01365bc7d.js"
      crossorigin="anonymous"
    ></script>

    <script
      type="text/javascript"
      src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"
    ></script>

    <script type="text/javascript" src="../JS/communityForum.js"></script>
    <script>
      function openForm1() {
        document.getElementById("myForm1").style.display = "block";
      }

      function closeForm1() {
        document.getElementById("myForm1").style.display = "none";
      }

      function openForm2() {
        document.getElementById("myForm2").style.display = "block";
      }

      function closeForm2() {
        document.getElementById("myForm2").style.display = "none";
      }

      // When the user clicks on <div>, open the popup
      function sellerDetails() {
        var popup = document.getElementById("myPopup");
        popup.classList.toggle("show");
}
    </script>
    <script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-auth.js"></script>

    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-firestore.js"></script>
    <!-- <script src="../JS/firebase.js"></script> -->
    <script type="module">
      const firebaseConfig = {
        apiKey: "AIzaSyD09nDzD73ieZzOvpLTj2H5nL9Ncrn9bVg",
        authDomain: "myntra-codeathon.firebaseapp.com",
        projectId: "myntra-codeathon",
        storageBucket: "myntra-codeathon.appspot.com",
        messagingSenderId: "796268558165",
        appId: "1:796268558165:web:4dcc91ef4727dbeec0e1dc",
        measurementId: "G-3N3QT2B8GB",
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      //     async function getUserDetails(uid) {
      //     await db
      //       .collection("users")
      //       .doc(uid)
      //       .get()
      //       .then((doc) => {
      //         let data = doc.data();
      //         return data;
      //     })
      //     .catch ((error) => {
      //       console.error("Error in getUserDetails:", error);
      //     });
      // }
      let postForm = document.querySelector(".bottomDiv");
      let addPostBtn = document.querySelector(".addPostBtn");
      let communityForm = document.getElementById("communityForm");
      let sellerForm = document.getElementById("sellerForm");
      let addCommunityPostForm = document.querySelector(
        ".addCommunityPostForm"
      );
      let addSellerPostForm = document.querySelector(".addSellerPostForm");

      addSellerPostForm.addEventListener("submit", (e) => {
        e.preventDefault();

        console.log("HEEEEEELLLLLOO");
        let sellerName = document.getElementById("seller-name").innerText;
        let sellerPostContent = document.getElementById(
          "sellerPostContent"
        ).value;
        console.log(sellerPostContent);
        sellerPostContent = String(sellerPostContent);
        firebase.auth().onAuthStateChanged(async (user) => {
          if (user) {
            let userId = user.uid;
            let userDetails = await getUserDetails(userId);
            let userName = userDetails.name;
            await createSellerPost(
              sellerName,
              userName,
              sellerPostContent,
              userId,
              sellerName
            );
            location.reload();
          } else {
            location.replace("Login.html");
          }
        });
      });

      addCommunityPostForm.addEventListener("submit", (e) => {
        e.preventDefault();

        console.log("HEEEEEELLLLLOO");
        let communityName = document.getElementById("community-name").innerText;
        let communityPostContent = document.getElementById(
          "communityPostContent"
        ).value;
        console.log(communityPostContent);
        communityPostContent = String(communityPostContent);
        firebase.auth().onAuthStateChanged(async (user) => {
          if (user) {
            let userId = user.uid;
            let userDetails = await getUserDetails(userId);
            let userName = userDetails.name;
            await createGroupPost(
              communityName,
              userName,
              communityPostContent,
              userId,
              communityName
            );
            location.reload();
          } else {
            location.replace("Login.html");
          }
        });
      });

      postForm.addEventListener("submit", (e) => {
        e.preventDefault();
        let postContent = document.getElementById("globalPostContent").value;
        console.log(postContent);
        postContent = String(postContent);
        firebase.auth().onAuthStateChanged(async (user) => {
          if (user) {
            let userId = user.uid;
            await createPopularPost("Fashion Freaks", postContent, userId);
            location.reload();
          } else {
            location.replace("Login.html");
          }
        });
      });

      communityForm.addEventListener("submit", (e) => {
        e.preventDefault();
        let communityNameInput =
          document.getElementById("communityNameInput").value;
        communityNameInput = String(communityNameInput);
        firebase.auth().onAuthStateChanged(async (user) => {
          if (user) {
            let userId = user.uid;
            await createGroup(userId, communityNameInput);
            location.reload();
          } else {
            location.replace("Login.html");
          }
        });
      });

      sellerForm.addEventListener("submit", (e) => {
        e.preventDefault();
        let sellerNameInput =
          document.getElementById("sellerNameInput").value;
          let sellerAddressInput = document.getElementById("sellerAddressInput").value;
          let sellerDescriptionInput = document.getElementById("sellerDescriptionInput").value;
        sellerNameInput = String(sellerNameInput);
        sellerAddressInput = String(sellerAddressInput);
        sellerDescriptionInput = String(sellerDescriptionInput);
        firebase.auth().onAuthStateChanged(async (user) => {
          if (user) {
            let userId = user.uid;
            await createSeller(userId, sellerNameInput, sellerAddressInput, sellerDescriptionInput);
            location.reload();
          } else {
            location.replace("Login.html");
          }
        });
      });

      // addPostBtn.onClick = function () {
      //     firebase.auth().onAuthStateChanged(async (user) => {
      //       if (user) {
      //         let userId = user.uid;
      //         await createPopularPost("Fashion Freaks", postContent.value, userId);
      //         big();
      //       }
      //       else {
      //               location.replace("Login.html");
      //             }
      //     });

      //   }

      async function getUserDetails(uid) {
        try {
          const doc = await db.collection("users").doc(uid).get();
          const data = doc.data();
          return data;
        } catch (error) {
          // Handle any errors here, e.g., log the error or return a default value
          console.error("Error in getUserDetails:", error);
          return null; // You can return an appropriate value in case of an error
        }
      }

      async function getSellerDetails(docId) {
        try {
          const doc = await db.collection("sellers").doc(docId).get();
          const data = doc.data();
          return data;
        } catch (error) {
          // Handle any errors here, e.g., log the error or return a default value
          console.error("Error in getUserDetails:", error);
          return null; // You can return an appropriate value in case of an error
        }
      }

      async function createGroup(uid, name) {
        await db
          .collection("groups")
          .where("name", "==", name)
          .get()
          .then(async (querySnapshot) => {
            if (querySnapshot.size > 0) {
              return "failure";
            } else {
              await db
                .collection("groups")
                .doc(name)
                .set({
                  name: name,
                  admin_uid: uid,
                  time: firebase.firestore.FieldValue.serverTimestamp(),
                })
                .then(async () => {
                  await db
                    .collection("groups")
                    .doc(name)
                    .collection("posts")
                    .doc("dummy")
                    .set({})
                    .then(() => {
                      db.collection("groups")
                        .doc(name)
                        .collection("posts")
                        .doc("dummy")
                        .delete();
                    })
                    .catch((error) => {
                      console.log("Error creating group", error);
                    });
                  return "success";
                });
            }
          });
      }

      async function createSeller(uid, name, address, description) {
        await db
          .collection("sellers")
          .where("name", "==", name)
          .get()
          .then(async (querySnapshot) => {
            if (querySnapshot.size > 0) {
              return "failure";
            } else {
              await db
                .collection("sellers")
                .doc(name)
                .set({
                  name: name,
                  address: address,
                  description: description,
                  admin_uid: uid,
                  time: firebase.firestore.FieldValue.serverTimestamp(),
                })
                .then(async () => {
                  await db
                    .collection("sellers")
                    .doc(name)
                    .collection("posts")
                    .doc("dummy")
                    .set({})
                    .then(() => {
                      db.collection("sellers")
                        .doc(name)
                        .collection("posts")
                        .doc("dummy")
                        .delete();
                    })
                    .catch((error) => {
                      console.log("Error creating group", error);
                    });
                  return "success";
                });
            }
          });
      }

      async function createGroupPost(
        community_name,
        sender_name,
        content,
        uid,
        docId
      ) {
        const collectionName = "groups"; // Replace with your actual collection name
        const docRef = db.collection(collectionName).doc(docId);

        try {
          const doc = await docRef.get();
          if (doc.exists) {
            const data = doc.data();
            const adminUid = data.admin_uid;

            if (uid === adminUid) {
              const postRef = await db
                .collection("groups")
                .doc(docId)
                .collection("posts")
                .add({
                  community_name: community_name,
                  sender_name: sender_name,
                  time: firebase.firestore.FieldValue.serverTimestamp(),
                  content: content,
                  upvotes: 0,
                  downvotes: 0,
                  uid: uid,
                });

              console.log("Document written with ID: ", postRef.id);
            } else {
              alert("Only the Community admin can post messages !!");
            }
          } else {
            console.log("Document does not exist.");
          }
        } catch (error) {
          console.error("Error creating group post:", error);
          // Handle errors here
        }
      }

      async function createSellerPost(
        seller_name,
        sender_name,
        content,
        uid,
        docId
      ) {
        const collectionName = "sellers"; // Replace with your actual collection name
        const docRef = db.collection(collectionName).doc(docId);

        try {
          const doc = await docRef.get();
          if (doc.exists) {
            const data = doc.data();
            const adminUid = data.admin_uid;

            if (uid === adminUid) {
              const postRef = await db
                .collection("sellers")
                .doc(docId)
                .collection("posts")
                .add({
                  seller_name: seller_name,
                  sender_name: sender_name,
                  time: firebase.firestore.FieldValue.serverTimestamp(),
                  content: content,
                  upvotes: 0,
                  downvotes: 0,
                  uid: uid,
                });

              console.log("Document written with ID: ", postRef.id);
            } else {
              alert("Only the Seller can post messages !!");
            }
          } else {
            console.log("Document does not exist.");
          }
        } catch (error) {
          console.error("Error creating seller post:", error);
          // Handle errors here
        }
      }

      async function createPopularPost(community_name, content, uid) {
        let userDetails = await getUserDetails(uid);
        let userName = userDetails.name;
        await db
          .collection("popular_posts")
          .add({
            community_name: community_name,
            sender_name: userName,
            time: firebase.firestore.FieldValue.serverTimestamp(),
            content: content,
            upvotes: 0,
            downvotes: 0,
            uid: uid,
            comments: [],
          })
          .then((docRef) => {
            console.log("Document written with ID: ", docRef.id);
          })
          .catch((error) => {
            console.error("Error adding document: ", error);
          });
      }

      async function getGroups() {
        let response = [];
        const collectionRef = db.collection("groups");
        await collectionRef
          .get()
          .then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
              let docId = doc.id;
              let docData = doc.data();
              let docResponse = {
                name: docData.name,
                admin_uid: docData.admin_uid,
                time: docData.time,
                doc_id: docId,
              };
              response.push(docResponse);
            });
          })
          .catch((error) => {
            console.error(error);
          });
        return response;
      }

      async function getSellers() {
        let response = [];
        const collectionRef = db.collection("sellers");
        await collectionRef
          .get()
          .then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
              let docId = doc.id;
              let docData = doc.data();
              let docResponse = {
                name: docData.name,
                address: docData.address,
                description: docData.description,
                admin_uid: docData.admin_uid,
                time: docData.time,
                doc_id: docId,
              };
              response.push(docResponse);
            });
          })
          .catch((error) => {
            console.error(error);
          });
        return response;
      }

      getSellers()
        .then((result) => {
          console.log(result);
          let sellerContainer = document.querySelector(".switchSeller");
          let count = 1;
          for (let s of result) {
            // console.log(s.address);
            let seller = document.createElement("div");
            seller.innerHTML = `<h3>${s.name}</h3>`;
            seller.className = "sell sellNames";
            seller.id = "sell" + count;
            seller.addEventListener("click", function () {
              loadSellerPosts(seller.innerText);
            });
            sellerContainer.appendChild(seller);
            // console.log(community.id);
            count++;
          }
        })
        .catch((err) => {
          console.log(err);
        });

      async function loadGroupPosts(name) {
        let communityName = document.getElementById("community-name");
        let communityPostsContainer = document.querySelector(
          ".communityPostsContainer"
        );
        communityName.innerText = name;
        communityPostsContainer.innerHTML = "";
        await getGroupPosts(name)
          .then((result) => {
            console.log(result);

            if (result.length > 0) {
              for (let p of result) {
                let post = document.createElement("div");
                post.innerHTML = `<div class="userInfo">
    <h5><a href="#">${p.sender_name}</a></h5>
  </div>
  
  
  
  
  <div class="postContent">
    ${p.content}
  </div>
  
  <hr><span class="votes"><a href="#" class="upVote">Upvote <img src="../IMAGES/Chat-Forum/upvote.svg" alt="" /> ${p.upvotes}</a></span><span class="votes"><a href="#" class="downVote">Downvote <img src="../IMAGES/Chat-Forum/downvote.svg" alt="" /> ${p.downvotes}</a></span>
  `;
                post.className = "communityPost";
                communityPostsContainer.appendChild(post);
              }
            } else {
              communityPostsContainer.innerText = "No posts yet!!";
            }
          })
          .catch((error) => {
            console.log("Error loading posts", error);
          });
      }

      async function getGroupPosts(docId) {
        let response = [];
        const collectionRef = db
          .collection("groups")
          .doc(docId)
          .collection("posts");
        await collectionRef
          .get()
          .then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
              let docId = doc.id;
              let docData = doc.data();
              let docResponse = {
                community_name: docData.community_name,
                sender_name: docData.sender_name,
                time: docData.time,
                content: docData.content,
                upvotes: docData.upvotes,
                downvotes: docData.downvotes,
                doc_id: docId,
                uid: docData.uid,
                // comments: docData.comments
              };
              response.push(docResponse);
            });
          })
          .catch((error) => {
            console.error(error);
          });
        return response;
      }

      async function loadSellerPosts(name) {
        let sellerName = document.getElementById("seller-name");
        let sellerDetails = document.getElementById("seller-details");
        let sellerPostsContainer = document.querySelector(
          ".sellerPostsContainer"
        );
        let sellerDet = await getSellerDetails(name);
        console.log(sellerDet);
        sellerDetails.innerHTML = `<div class="sellerPopup" onclick="sellerDetails()">View Seller Details
  <span class="popuptext" id="myPopup"><p><b>Name: </b>${sellerDet.name}</p>
        <p><b>Address: </b>${sellerDet.address}</p>
        <p><b>Description: </b>${sellerDet.description}</p></span>
</div>`;
        sellerName.innerText = name;
        sellerPostsContainer.innerHTML = "";
        await getSellerPosts(name)
          .then((result) => {
            console.log(result);

            if (result.length > 0) {
              for (let p of result) {
                let post = document.createElement("div");
                post.innerHTML = `<div class="userInfo">
    <h5><a href="#">${p.sender_name}</a></h5>
  </div>
  
  
  
  
  <div class="postContent">
    ${p.content}
  </div>
  
  <hr><span class="votes"><a href="#" class="upVote">Upvote <img src="../IMAGES/Chat-Forum/upvote.svg" alt="" /> ${p.upvotes}</a></span><span class="votes"><a href="#" class="downVote">Downvote <img src="../IMAGES/Chat-Forum/downvote.svg" alt="" /> ${p.downvotes}</a></span>
  `;
                post.className = "sellerPost";
                sellerPostsContainer.appendChild(post);
              }
            } else {
              sellerPostsContainer.innerText = "No posts yet!!";
            }
          })
          .catch((error) => {
            console.log("Error loading posts", error);
          });
      }

      async function getSellerPosts(docId) {
        let response = [];
        const collectionRef = db
          .collection("sellers")
          .doc(docId)
          .collection("posts");
        await collectionRef
          .get()
          .then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
              let docId = doc.id;
              let docData = doc.data();
              let docResponse = {
                seller_name: docData.seller_name,
                sender_name: docData.sender_name,
                time: docData.time,
                content: docData.content,
                upvotes: docData.upvotes,
                downvotes: docData.downvotes,
                doc_id: docId,
                uid: docData.uid,
                // comments: docData.comments
              };
              response.push(docResponse);
            });
          })
          .catch((error) => {
            console.error(error);
          });
        return response;
      }

      async function getPopularPosts() {
        let response = [];
        const collectionRef = db.collection("popular_posts");
        await collectionRef
          .get()
          .then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
              let docId = doc.id;
              let docData = doc.data();
              let docResponse = {
                community_name: docData.community_name,
                sender_name: docData.sender_name,
                time: docData.time,
                content: docData.content,
                upvotes: docData.upvotes,
                downvotes: docData.downvotes,
                doc_id: docId,
                uid: docData.uid,
                comments: docData.comments,
              };
              response.push(docResponse);
            });
          })
          .catch((error) => {
            console.error(error);
          });
        return response;
      }

      //   async function addCommentsToPost(docId, uid, content) {

      //   let userDetails = await getUserDetails(uid);

      //   let userName = userDetails.name;
      //   // console.log(userName);
      //   await db
      //     .collection("popular_posts")
      //     .doc(docId)
      //     .update({
      //       comments: firebase.firestore.FieldValue.arrayUnion({
      //         uid: uid,
      //         name: userName,
      //         content: content,
      //         time: firebase.firestore.FieldValue.serverTimestamp(),
      //       }),
      //     })
      //     .catch((err) => {
      //       console.error(err);
      //     });
      // }

      async function addCommentsToPost(docId, uid, content) {
        try {
          // Get user details based on UID
          const userDetails = await getUserDetails(uid);
          const userName = userDetails.name;
          console.log(docId);
          // console.log(userName);
          // Create a new comment object
          const newComment = {
            uid: uid,
            name: userName,
            content: content,
            time: firebase.firestore.FieldValue.serverTimestamp(),
          };

          // Update the "comments" array in the specified document
          await db
            .collection("popular_posts")
            .doc(docId)
            .update({
              comments: firebase.firestore.FieldValue.arrayUnion(newComment),
            });

          console.log("Comment added successfully");
        } catch (error) {
          console.error("Error adding comment:", error);
        }
      }

      async function upvotePost(docId, upvotes) {
        await this.db.collection("popular_posts").doc(docId).update({
          upvotes: ++upvotes,
        });
      }

      getGroups()
        .then((result) => {
          console.log(result);
          let communityContainer = document.querySelector(".switch");
          let count = 1;
          for (let c of result) {
            let community = document.createElement("div");
            community.innerHTML = `<h3>${c.name}</h3>`;
            community.className = "comm commNames";
            community.id = "comm" + count;
            community.addEventListener("click", function () {
              loadGroupPosts(community.innerText);
            });
            communityContainer.appendChild(community);
            // console.log(community.id);
            count++;
          }
        })
        .catch((err) => {
          console.log(err);
        });

      getPopularPosts()
        .then((result) => {
          console.log(result);
          let popularPostsContainer = document.querySelector(
            ".popularPostsContainer"
          );
          for (let p of result) {
            let post = document.createElement("div");
            post.innerHTML = `<div class="userInfo">
    <h5><a href="#">${p.sender_name}</a><span class="communityName">${p.community_name}</span></h5>
  </div>
  
  
  
  
  <div class="postContent">
    ${p.content}
  </div>
  
  <hr><span class="votes"><a href="#" class="upVote">Upvote <img src="../IMAGES/Chat-Forum/upvote.svg" alt="" /> ${p.upvotes}</a></span><span class="votes"><a href="#" class="downVote">Downvote <img src="../IMAGES/Chat-Forum/downvote.svg" alt="" />${p.downvotes}</a></span>
  `;
            post.className = "popularPost";
            popularPostsContainer.appendChild(post);
            let addCommentForm = document.createElement("form");
            addCommentForm.innerHTML = `<input class="addCommentContent" placeholder="Type your comment..."/>
<button class="addCommentBtn">Add Comment</button>`;
            addCommentForm.className = "addCommentForm";
            popularPostsContainer.appendChild(addCommentForm);
            addCommentForm.addEventListener("submit", (e) => {
              e.preventDefault();
              const commentContent =
                document.querySelector(".addCommentContent").value;
              // var user = firebase.auth().currentUser;
              firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                  var uid = user.uid;
                  // console.log(uid);
                  // console.log(user.name);
                  var docId = p.doc_id;
                  // console.log(docId);
                  addCommentsToPost(docId, user.uid, commentContent);
                  location.replace("communityForum.html");
                } else {
                  location.replace("Login.html");
                }
              });
            });
            let commentsNumber = document.createElement("h5");
            if (p.comments.length === 0) {
              commentsNumber.innerText = "No comments yet";
            } else {
              if (p.comments.length === 1) {
                commentsNumber.innerText = p.comments.length + " comment :";
              } else {
                commentsNumber.innerText = p.comments.length + " comments :";
              }
            }
            commentsNumber.className = "commentsNumber";
            popularPostsContainer.appendChild(commentsNumber);
            for (let c of p.comments) {
              let comment = document.createElement("div");
              comment.innerHTML = `<div class="userInfo">
            <h5><a href="#">${c.name}</a></h5>
            </div>
            <div class="commentContent">
              ${c.content}
            </div>`;
              comment.className = "comment";
              popularPostsContainer.appendChild(comment);
            }
          }
        })
        .catch((err) => {
          console.log(err);
        });
      //       getPopularPosts()
      //       .then((result)=>{
      //         console.log(result)
      //         let popularPostsContainer = document.querySelector(".popularPostsContainer");
      //         for (let p of result)
      //         {
      //           let post = document.createElement("div");
      //           post.innerHTML = `<div class="userInfo">
      //     <h5><a href="#">${p.sender_name}</a><span class="communityName">${p.community_name}</span></h5>
      //   </div>

      //   <div class="postContent">
      //     ${p.content}
      //   </div>

      //   <hr><span class="votes"><a href="#" class="upVote">Upvote ${p.upvotes}</a></span><span class="votes"><a href="#" class="downVote">Downvote ${p.downvotes}</a></span>
      //   `;
      //           post.className = 'popularPost';
      //           popularPostsContainer.appendChild(post);
      //           let addCommentForm = document.createElement("form");
      //           addCommentForm.innerHTML = `<input class="addCommentContent" placeholder="Type your comment..."/>
      // <button class="addCommentBtn">Add Comment</button>`;
      //           addCommentForm.className = "addCommentForm";
      //           popularPostsContainer.appendChild(addCommentForm);
      //           addCommentForm.addEventListener('submit', e => {
      //             e.preventDefault();
      //             const commentContent = document.querySelector(".addCommentContent").value;
      //             // var user = firebase.auth().currentUser;
      //             firebase.auth().onAuthStateChanged((user) => {
      //               if (user) {
      //                 var uid = user.uid;
      //                 // console.log(uid);
      //                 // console.log(user.name);
      //                 var docId = p.doc_id;
      //                 // console.log(docId);
      //                 addCommentsToPost(docId, user.uid, commentContent);
      //                 location.replace("communityForum.html");
      //               }
      //               else {
      //                 location.replace("Login.html");
      //               }
      //             })
      //           })
      //           let commentsNumber = document.createElement("h5");
      //           if (p.comments.length === 0)
      //           {
      //             commentsNumber.innerText = "No comments yet";
      //           }
      //           else
      //           {
      //             if (p.comments.length === 1)
      //             {
      //               commentsNumber.innerText = p.comments.length + " comment :";
      //             }
      //             else
      //             {
      //               commentsNumber.innerText = p.comments.length + " comments :";
      //             }

      //           }
      //           commentsNumber.className = "commentsNumber";
      //           popularPostsContainer.appendChild(commentsNumber);
      //           for (let c of p.comments)
      //           {
      //             let comment = document.createElement("div");
      //             comment.innerHTML = `<div class="userInfo">
      //             <h5><a href="#">${c.name}</a></h5>
      //             </div>
      //             <div class="commentContent">
      //               ${c.content}
      //             </div>`;
      //             comment.className = "comment";
      //             popularPostsContainer.appendChild(comment);
      //           }
      //         }

      //       })
      //       .catch(err=>{
      //         console.log(err)
      //       });
    </script>
   
  </body>
</html>

<!-- <div>
  <div class="userInfo">
    <h5>
      <a href="#">${p.sender_name}</a
      ><span class="communityName">${p.community_name}</span>
    </h5>
  </div>
  <hr />
  <div class="postContent">${p.content}</div>
  <hr />
</div>

<span class="addComment"><button class="addCommentBtn">Add comment</button></span> -->

<!-- <span class="voteIcons icon1"><i class="far fa-thumbs-up"></i></span><span class="voteIcons icon2"><i class="far fa-thumbs-down"></i></span> -->

<!-- <input class="addCommentContent" placeholder="Type your comment..." />
<button class="addCommentBtn">Add Comment</button> -->
